<%- include('partials/header', { title: 'Page de connexion' , description: "Page de connexion du site SEO Sympa." ,
    page: 'dashboard' , description: "Tableau de bord d'un utilisateur inscrit sur le site SEO-Sympa" }) %>
    
            <main class="accessibility-main">
                <h1> Mon profil </h1>
                <section class="declaration-section">
                    <h2>Bienvenue <%= profile.firstname %> !</h2>
                    
                    <div class="profil-info">
                        <h2>
                            <%= profile.firstname %>
                                <%= profile.lastname %>

    <main class="accessibility-main">
        <h1> Mon profil </h1>
        <section class="declaration-section">
            <img src="https://via.placeholder.com/150" alt="Photo du profil" class="profil-photo">
            <div class="profil-info">
                <h2>
                    <%= profile.firstname %>
                        <%= profile.lastname %>

                </h2>

            </div>

            <div>
                <h3>localisation</h3>
                <p>
                    <%= profile.address %>
                </p>
                <p>
                    <%= profile.city %>
                </p>
                <h3>Code postal</h3>
                <p>
                    <%= profile.zipcode %>
                </p>

            </div>

            <div>
                <h3>Nom de la soci√©t√©</h3>
                <p>
                    <%= profile.display_name %>
                </p>
            </div>

            <div>
                <h3>Num√©ro d'identification de l'entreprise</h3>
                <p>
                    <%= profile.company_identification_system %>
                </p>
            </div>
            <div>
                <h3>Description</h3>
                <p>
                    <%= profile.description %>
                </p>
            </div>
            <a href="/dashboard-edite">
                <button class="button__append">modifier votre profil </button>
            </a>
            <form action="/delete-account-confirm" method="GET">
                <button class="button__append" type="submit">Supprimer mon compte</button>
            </form>

        </section>

        <section>
            <h2>Mes relations</h2>
            <table>
                <tr>
                    <th>Nom d'affichage</th>
                    <th>Date de la demande üìÖ</th>
                    <!-- <th>Date d'acceptation</th>
                    <th>Date de refus</th> -->
                    <th>Statut de la relation</th>
                    <th>Actions</th>
                </tr>
                <% relations.forEach(relation=> { 
                    //console.log('--------------------------------------- relation', relation);
                    //console.log('****************************profile sender : ', relation.sender); // contient une instance de User
                    //console.log('****************************profile recipient', relation.recipient); // contient une instance de User
                    // essayer de voir ce qu'il y a dans Profile (qui semble contenu dans relation.sender / relation.recipient)
                    //console.log('[DASHBOARD] profil du sender : ', relation.sender.Profile);
                    const senderProfile = relation.sender.Profile;
                    //console.log('[DASHBOARD] profil du recipient : ', relation.recipient.Profile);
                    const recipientProfile = relation.recipient.Profile;
                    //console.log('[DASHBOARD] profil du sender - firstname :', senderProfile.dataValues.firstname);
                    //console.log('[DASHBOARD] profil du recipient - firstname :', recipientProfile.dataValues.firstname);
                    const isSender = senderProfile.dataValues.user_id === locals.userId;
                    
                    %>
                    <tr>
                        <td> 
                            <% /* ici, on est dans le cas o√π on doit afficher le destinaire si on est √† l'origine de la demande, ou l'exp√©diteur si on est le destinataire 
                            Si senderProfile.dataValues.user_id = mon id √† moi (res.locals.userId) => j'affiche recipientProfile.dataValues.display_name 
                            Sinon j'affiche senderProfile.dataValues.display_name */ %>
                            <% if (senderProfile.dataValues.user_id === locals.userId) { %>
                                <a href="/profil/<%= recipientProfile.dataValues.user_id %>">
                                    <%= recipientProfile.dataValues.display_name %>
                                </a>
                            <% } else { %>
                                <a href="/profil/<%= senderProfile.dataValues.user_id %>">
                                    <%= senderProfile.dataValues.display_name %>
                                </a>
                            <% } %>
                        </td>
                        <td>
                            <%= relation.dataValues.created_at %>
                        </td>
                        
                        <td>

                            <% if (relation.dataValues.status === 'relation accept√©e') { %>
                                <%= relation.dataValues.status %> le <%= relation.dataValues.approval_date %>
                            <% } else if (relation.dataValues.status === 'relation refus√©e') { %>
                                <%= relation.dataValues.status %> le <%= relation.dataValues.removal_date %>
                            <% } else { %>
                                <%= relation.dataValues.status %>
                            <% } %>
                        </td>
                        <td>
                            <% if (isSender && relation.dataValues.status ==='en attente de r√©ponse' ) { %>
                                <form method="POST" action="/relation/supprimer/<%= relation.id_relation %>">
                                    <input type="hidden" name="id" value="<%= relation.id %>">
                                    <button>‚ùå pour supprimer cette demande</button>
                                </form>
                                <% } else if (!isSender && relation.dataValues.status ==='en attente de r√©ponse' ) { %>
                                    <form method="POST" action="/relation/accepter/<%= relation.id_relation %>">
                                        <input type="hidden" name="id" value="<%= relation.id %>">
                                        <button>‚úÖ pour accepter cette demande</button>
                                    </form>

                                    <form method="POST" action="/relation/refuser/<%= relation.id_relation %>">
                                        <input type="hidden" name="id" value="<%= relation.id %>">
                                        <button type="submit">‚ùå pour refuser cette demande</button>
                                    </form>


                                    <% } else { %>
                                        <form method="POST" action="/relation/supprimer/<%= relation.id_relation %>">
                                            <input type="hidden" name="id" value="<%= relation.id %>">
                                            <button>‚ùå pour supprimer ce contact</button>
                                        </form>
                                        <% } %>
                        </td>
                    </tr>
                    <% }); %>
            </table>
        </section>

    </main>
    <%- include('partials/footer') %>
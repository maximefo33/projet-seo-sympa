<%- include('partials/header', { title: 'Page profil public de ' + profile.display_name,
  description: 'Découvrez le profil public de ' + profile.display_name, bodyClass:'public-profile-page' }) %>

  <!-- ici c'est la page profil public d'un expert en détail (lien : /profil/:id) -->

  <main class="public-profile-main">
    <section class="card">
      <!-- <div class="card__image">
        <img src="/assets/img/profile-img.png" alt="Portrait de Marie Dupont" />
      </div> -->
      <div class="card__info">
        <h1 class="card__name">
          <%= profile.firstname %>
        </h1>
        <h1 class="card__name">
          <%= profile.lastname %>
        </h1>
        <p class="card__location">
          <%= profile.address %>
        </p>
        <p class="card__location">
          <%= profile.city %>
        </p>
        <p class="card__location">
          <%= profile.zipcode %>
        </p>
        <p class="card__location">
          <%= profile.company_identification_system %>
        </p>
        <p class="card__bio">
          <%= profile.description %>
        </p>
      </div>


      <!-- penser à écrire que pour faire une demande de connexion, l'utilisateur doit d'abord être inscrit et connecté sur seo sympa -->

      <!-- si l'utilisateur connecté est le même que l'utilisateur dont le profil est visité, alors demande de connexion impossible  -->

      <!-- // ici essai pour séparer les if -->

      <% if (!session?.userId) { %>

        <p>Vous devez être connecté pour envoyer une demande de connexion.</p>
<!-- // ligne 46 voir pour débuguer -->
        <% } else if (profile.id ===session.userId) { %>

          <p>Vous ne pouvez pas demander à vous connecter à votre propre réseau.</p>

          <% } else { %>
            <!-- L'utilisateur est connecté et regarde un autre profil -->
             <!-- relations existe toujours et est toujours un tableau. Il sera vide s'il n'y a pas de relation entre les deux utilisateurs -->
            <% if (relations.length === 0) { %> 
              <form action="/relation/demander/<%= profile.id %>" method="POST" class="relation-form">
                <button type="submit" class="button cardcontact">Vous souhaitez rejoindre mon réseau ? 
                 </button>
                </form>

              <% } 
              // ici, je force la récupération du premier élément de relations, car il n'est censé y en avoir qu'un seul
              else if (relations[0].status === 'relation en cours') { %>
                <p>Vous avez déjà envoyé une demande de connexion à ce profil.</p>
                <p class="cardinfo">
                  <%= profile.User.dataValues.email %>
                  // ! warning : ici on doit afficher le mail de l'autre utilisateur, à récupérer dans User, pas transmis actuellement 
                  %> 
                </p>

                <% } else if (relations[0].status === 'relation refusée') { %>
                  <form action="/relation/demander/<%= profile.id %>" method="POST" class="relation-form">
                    <button type="submit" class="button cardcontact">Vous souhaitez rejoindre mon réseau ?</button>
                  </form>

                <% }
              else if (relations[0].status==='relation acceptée' ) { %>
                  <p>Vous êtes déjà en relation avec ce profil.</p>
                <p class="cardinfo">
                  <%= user.email %>
                </p>

                <% } else if (relations[0].status==='en attente de réponse' ) { %>
                  <p>Demande de connexion déjà en attente, merci de patienter pour la réponse.</p>

                  <% } else if (relations[0].status==='relation refusée' ) { %>
                    <form action="/relation/demander/<%= profile.id %>" method="POST" class="relation-form">
                      <button type="submit" class="button cardcontact">Vous souhaitez rejoindre mon réseau ?</button>
                    </form>
                    <% } %>
                      <% } %>



    </section>
    <!-- <script>
      function showLoader()
{ document.getElementById('wait').style.display = 'inline';

}    </script> -->

 <!-- <img id="wait"   src="/assets/img/wait.gif" alt=" image gif en attente" style="display: none; will-change: auto;"> -->
  </main>

  <%- include('partials/footer') %>